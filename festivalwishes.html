<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Camera & Greetings â€” A â†’ Z Beautiful Page</title>
  <meta name="description" content="A beautiful all-in-one camera permission demo with capture, switch camera, download and helpful permission guidance."/>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23007BFF'/%3E%3Ctext x='50' y='57' font-size='36' text-anchor='middle' fill='white' font-family='Arial' %3EðŸ“·%3C/text%3E%3C/svg%3E" />

  <style>
    :root{
      --bg1: linear-gradient(135deg,#0ea5e9 0%,#7c3aed 100%);
      --card: rgba(255,255,255,0.06);
      --glass: rgba(255,255,255,0.06);
      --accent: #ff7ab6;
      --muted: rgba(255,255,255,0.75);
      --shadow: 0 10px 30px rgba(2,6,23,0.45);
      font-synthesis: none;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;color:var(--muted);background:var(--bg1);-webkit-font-smoothing:antialiased}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:28px}
    .card{
      width:100%;max-width:980px;border-radius:16px;padding:20px;background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      box-shadow: var(--shadow);backdrop-filter: blur(6px);border:1px solid rgba(255,255,255,0.06);
    }

    header{display:flex;gap:16px;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#00f5a0 0%,#00b4d8 100%);display:flex;align-items:center;justify-content:center;font-size:26px;box-shadow:0 8px 20px rgba(2,6,23,0.3)}
    h1{font-size:1.25rem;color:white;margin:0}
    p.lead{margin:0;color:rgba(255,255,255,0.9);opacity:0.95;font-size:.95rem}

    .grid{display:grid;grid-template-columns: 1fr 360px;gap:18px;margin-top:18px}
    @media (max-width:920px){ .grid{grid-template-columns:1fr} }

    /* left area */
    .left{padding:12px}
    .stage{
      background:linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.14));
      border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.04);
      display:flex;flex-direction:column;align-items:center;gap:10px;min-height:360px;justify-content:center;
    }
    video#preview{width:100%;max-width:820px;border-radius:12px;background:#000;outline:2px solid rgba(255,255,255,0.03)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px}
    button{border:0;padding:10px 14px;border-radius:10px;background:rgba(255,255,255,0.06);color:white;cursor:pointer;font-weight:600;backdrop-filter: blur(2px)}
    button.primary{background:linear-gradient(90deg,var(--accent),#ffcc66);color:#08243b;box-shadow:0 6px 18px rgba(255,122,170,0.12)}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
    .muted{font-size:.9rem;color:rgba(255,255,255,0.75)}
    .status{font-size:.9rem;margin-top:6px}

    /* right area */
    .right{padding:12px;display:flex;flex-direction:column;gap:12px}
    .card-panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.04)}
    .controls-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .small{font-size:.9rem;color:rgba(255,255,255,0.8)}

    /* gallery */
    .gallery{display:flex;gap:8px;flex-wrap:wrap}
    .thumb{width:84px;height:60px;border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,0.04);background:#000;display:flex;align-items:center;justify-content:center}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}

    footer{display:flex;justify-content:space-between;align-items:center;margin-top:14px;gap:12px}
    .help{font-size:.84rem;color:rgba(255,255,255,0.72)}

    /* nice micro animations */
    .pulse{animation:pulse 2s ease-in-out infinite}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}

    /* accessibility focus */
    button:focus{outline:3px solid rgba(255,255,255,0.12);outline-offset:2px}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <main class="wrap" role="main">
    <section class="card" aria-labelledby="page-title">
      <header>
        <div class="brand">
          <div class="logo" aria-hidden="true">ðŸ“·</div>
          <div>
            <h1 id="page-title">A â†’ Z Camera & Greetings</h1>
            <p class="lead">Beautiful camera demo: permission handling, capture, switch, download & friendly guidance.</p>
          </div>
        </div>
        <div class="muted">Built: <strong id="build-date"></strong></div>
      </header>

      <div class="grid" role="region" aria-label="Main content">
        <!-- LEFT: Camera Stage -->
        <div class="left">
          <div class="stage" id="stage">
            <video id="preview" autoplay playsinline muted aria-label="Camera preview"></video>

            <div class="controls" role="group" aria-label="camera controls">
              <button id="startBtn" class="primary" title="Request camera permission and start camera">Start Camera</button>
              <button id="switchBtn" class="ghost" title="Switch front/back camera">Switch Camera</button>
              <button id="captureBtn" class="ghost" title="Take snapshot">Capture</button>
              <button id="stopBtn" class="ghost" title="Stop camera">Stop</button>
            </div>

            <div class="status" id="status" aria-live="polite">Permission status: <strong id="perm">unknown</strong></div>
          </div>
        </div>

        <!-- RIGHT: Controls, gallery, help -->
        <aside class="right" aria-label="Controls and saved photos">
          <div class="card-panel">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div>
                <div class="small">Facing</div>
                <div><strong id="facingLabel">user (front)</strong></div>
              </div>
              <div>
                <div class="small">Resolution</div>
                <div><strong id="resLabel">auto</strong></div>
              </div>
            </div>

            <hr style="border:none;height:8px;opacity:.03;margin:12px 0;border-radius:6px;background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent)">

            <div class="small">Captured photos</div>
            <div class="gallery" id="gallery" aria-live="polite" aria-atomic="true">
              <!-- thumbs go here -->
            </div>

            <div style="margin-top:10px;display:flex;gap:8px">
              <button id="clearGallery" class="ghost">Clear Gallery</button>
              <button id="downloadAll" class="ghost">Download All (.zip)</button>
            </div>
          </div>

          <div class="card-panel">
            <div class="small">Hints & Troubleshooting</div>
            <ul style="margin:8px 0 0 18px;color:var(--muted);font-size:0.92rem">
              <li>Use <strong>HTTPS</strong> or <code>http://localhost</code> â€” browsers block camera on insecure pages.</li>
              <li>If permission is denied, open your browser's site settings and allow camera access.</li>
              <li>On mobile, enable camera and microphone permissions in OS settings if asked.</li>
            </ul>
            <div style="margin-top:8px">
              <button id="helpBtn" class="ghost">Show Permission Guide</button>
            </div>
          </div>

          <div class="card-panel">
            <div class="small">Extras</div>
            <p style="margin:8px 0;color:var(--muted)">This page does not upload images anywhere â€” captures are stored locally in the browser session.</p>
            <div style="display:flex;gap:8px;margin-top:6px">
              <button id="downloadLast" class="ghost">Download Last</button>
              <button id="copyLast" class="ghost">Copy Last to Clipboard</button>
            </div>
          </div>
        </aside>
      </div>

      <footer>
        <div class="help">Need help? <button id="helpOpen" class="ghost">Open guide</button></div>
        <div style="font-size:.85rem;color:rgba(255,255,255,0.65)">Made with â™¥ â€” Aâ†’Z Demo</div>
      </footer>
    </section>
  </main>

  <!-- Hidden canvas for capture -->
  <canvas id="canvas" width="1280" height="720" class="sr-only" aria-hidden="true"></canvas>

  <script>
    // Build date
    document.getElementById('build-date').textContent = new Date().toLocaleString();

    // Elements
    const preview = document.getElementById('preview');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const switchBtn = document.getElementById('switchBtn');
    const captureBtn = document.getElementById('captureBtn');
    const statusEl = document.getElementById('perm');
    const facingLabel = document.getElementById('facingLabel');
    const resLabel = document.getElementById('resLabel');
    const gallery = document.getElementById('gallery');
    const canvas = document.getElementById('canvas');
    const downloadLast = document.getElementById('downloadLast');
    const clearGallery = document.getElementById('clearGallery');
    const copyLast = document.getElementById('copyLast');
    const downloadAll = document.getElementById('downloadAll');

    let stream = null;
    let useFacing = 'user'; // 'user' or 'environment'
    let lastImageDataUrl = null;
    let savedImages = [];

    // Util: set permission text
    function setStatus(text, info='') {
      statusEl.textContent = text;
      if(info) statusEl.title = info;
    }

    // Check permission via Permissions API (best-effort)
    async function checkPermission() {
      try {
        if (navigator.permissions && navigator.permissions.query) {
          // try camera permission name; not all browsers support 'camera' name
          let state = 'unknown';
          try {
            const p = await navigator.permissions.query({name: 'camera'});
            state = p.state;
            p.onchange = () => setStatus(p.state);
          } catch (err) {
            // fallback: query 'microphone' or ignore
            state = 'unknown';
          }
          setStatus(state);
          return state;
        }
      } catch (e) {
        // ignore
      }
      setStatus('unknown');
      return 'unknown';
    }

    // Start camera with constraints
    async function startCamera() {
      setStatus('requesting');
      const constraints = { video: { facingMode: { ideal: useFacing }, width: { ideal: 1280 }, height: { ideal: 720 } }, audio: false };
      try {
        stream = await navigator.mediaDevices.getUserMedia(constraints);
        preview.srcObject = stream;
        preview.play();
        setStatus('granted');
        const track = stream.getVideoTracks()[0];
        const settings = track.getSettings ? track.getSettings() : {};
        facingLabel.textContent = (settings.facingMode || useFacing) + (settings.deviceId ? '' : '');
        resLabel.textContent = (settings.width ? settings.width + 'Ã—' + settings.height : 'auto');
      } catch (err) {
        console.error('startCamera error', err);
        if (err.name === 'NotAllowedError' || err.name === 'SecurityError') {
          setStatus('denied', 'Permission denied â€” open browser/site settings to allow camera.');
          alert('Camera permission denied. Please allow camera in the browser prompt or site settings.');
        } else if (err.name === 'NotFoundError') {
          setStatus('no-camera', 'No camera found on this device.');
          alert('No camera found on this device.');
        } else {
          setStatus('error', err.message);
          alert('Unable to open camera: ' + err.message);
        }
      }
    }

    function stopCamera() {
      if (!stream) { setStatus('stopped'); return; }
      stream.getTracks().forEach(t => t.stop());
      preview.srcObject = null;
      stream = null;
      setStatus('stopped');
    }

    // Switch camera facing
    async function switchCamera() {
      useFacing = (useFacing === 'user') ? 'environment' : 'user';
      facingLabel.textContent = useFacing;
      stopCamera();
      // small delay helps some devices
      setTimeout(() => startCamera(), 250);
    }

    // Capture photo to dataURL and show in gallery
    function capturePhoto() {
      if (!stream) { alert('Camera not started. Click "Start Camera" first.'); return; }
      const videoTrack = stream.getVideoTracks()[0];
      const settings = videoTrack.getSettings ? videoTrack.getSettings() : {};
      const w = settings.width || preview.videoWidth || 1280;
      const h = settings.height || preview.videoHeight || 720;
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext('2d');

      // If front camera, mirror the image so saved photo looks correct
      const isFront = (settings.facingMode === 'user' || useFacing === 'user');
      if (isFront) {
        ctx.save();
        ctx.scale(-1,1);
        ctx.drawImage(preview, -w, 0, w, h);
        ctx.restore();
      } else {
        ctx.drawImage(preview, 0, 0, w, h);
      }

      const dataUrl = canvas.toDataURL('image/png');
      lastImageDataUrl = dataUrl;
      savedImages.unshift(dataUrl);
      renderGallery();
    }

    // Render gallery thumbnails
    function renderGallery() {
      gallery.innerHTML = '';
      savedImages.slice(0, 12).forEach((src, idx) => {
        const el = document.createElement('div');
        el.className = 'thumb';
        el.innerHTML = `<img src="${src}" alt="Captured photo ${idx+1}" /><div style="position:absolute;right:6px;bottom:6px"></div>`;
        el.addEventListener('click', () => {
          // open in new tab/fullsize
          const w = window.open('');
          w.document.write(`<img src="${src}" style="width:100%;height:auto;display:block">`);
        });
        gallery.appendChild(el);
      });
    }

    // Download last image
    function downloadDataUrl(dataUrl, name='photo.png') {
      const a = document.createElement('a');
      a.href = dataUrl;
      a.download = name;
      document.body.appendChild(a);
      a.click();
      a.remove();
    }

    function downloadLastPhoto() {
      if (!lastImageDataUrl) { alert('No photo captured yet.'); return; }
      downloadDataUrl(lastImageDataUrl, `capture-${Date.now()}.png`);
    }

    // copy last to clipboard (image)
    async function copyLastToClipboard() {
      if (!lastImageDataUrl) { alert('No photo captured yet.'); return; }
      try {
        const res = await fetch(lastImageDataUrl);
        const blob = await res.blob();
        if (navigator.clipboard && navigator.clipboard.write) {
          const item = new ClipboardItem({ [blob.type]: blob });
          await navigator.clipboard.write([item]);
          alert('Photo copied to clipboard.');
        } else {
          alert('Clipboard image write not supported in this browser.');
        }
      } catch (err) {
        console.error(err);
        alert('Failed to copy: ' + err.message);
      }
    }

    // Clear gallery
    function clearGalleryFn() {
      if (!confirm('Clear all saved photos from this session?')) return;
      savedImages = [];
      lastImageDataUrl = null;
      renderGallery();
    }

    // Download all as .zip â€” simple approach using JSZip would be ideal, but we avoid external libs.
    // We'll bundle as multiple downloads (one by one) to avoid big dependency â€” show a friendly message.
    async function downloadAllPhotos() {
      if (savedImages.length === 0) { alert('No photos to download.'); return; }
      if (!confirm('Download all captured photos? They will be downloaded one by one.')) return;
      for (let i = 0; i < savedImages.length; i++) {
        downloadDataUrl(savedImages[i], `capture-${i+1}.png`);
        // small pause so browser can queue downloads
        await new Promise(r => setTimeout(r, 400));
      }
      alert('Downloads started (check browser downloads).');
    }

    // Event wiring
    startBtn.addEventListener('click', startCamera);
    stopBtn.addEventListener('click', stopCamera);
    switchBtn.addEventListener('click', switchCamera);
    captureBtn.addEventListener('click', capturePhoto);
    downloadLast.addEventListener('click', downloadLastPhoto);
    copyLast.addEventListener('click', copyLastToClipboard);
    clearGallery.addEventListener('click', clearGalleryFn);
    downloadAll.addEventListener('click', downloadAllPhotos);

    // Help button
    document.getElementById('helpBtn').addEventListener('click', () => {
      alert('If permission is denied, reload the page and allow camera when the browser asks. If the prompt does not appear, open browser site settings and grant Camera permission for this site. Use HTTPS (or localhost) â€” insecure pages cannot use the camera.');
    });
    document.getElementById('helpOpen').addEventListener('click', () => document.getElementById('helpBtn').click());

    // Auto-check permission on load (best-effort)
    checkPermission();

    // Accessibility: keyboard shortcuts
    window.addEventListener('keydown', (e) => {
      if (e.key === 'c' && e.ctrlKey) { capturePhoto(); e.preventDefault(); } // Ctrl+C to capture (example)
    });

    // Clean up camera when page unloads
    window.addEventListener('beforeunload', stopCamera);
  </script>
</body>
</html>